import React from 'react';
window.React = React;
import Router, { Route } from 'react-router';
import _ from 'lodash';

var components = {};

var routes = {{{ json }}};

{{#each routes}}
import {{ name }} from '{{ componentPath }}';
components['{{ name }}'] = {{ name }};
{{/each}}

var routesWithComponent = _.map(routes, function(route) {
  route.Component = components[route.name];
  return route;
});

console.log('Got routes', routesWithComponent);

var router = Router.create({
  location: Router.HistoryLocation,
  routes: _.map(routesWithComponent, function(route) {

    if (route.path.slice(-1) !== '/' && route.path.length > 1) {
      route.path = route.path + '/';
    }
    console.log('Defining route with path ' + route.path);

    return (
      <Route key={route.path}
        name={route.name}
        path={route.path}
        handler={route.Component}>
      </Route>
    );
  })
});

router.run(function(Handler, state) {
  React.render(<Handler router={router} routes={routes} />, document.getElementById('root'), () => {
    console.log('Route Change', state);
  });
});

